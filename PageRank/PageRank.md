---
title: PageRank
tags: Machine_learning
show_subscribe: false
author: Zhu Jianing
---

图链接分析的一种经典算法：PageRank

前不久做美赛建模时恰好有一问题需要进行图的分析，但是事后才想起来这个算法，顺便整理一下。

<!--more-->

|      类别      |   算法   |       主要模型       |   求解方向   |  解法  |
| :------------: | :------: | :------------------: | :----------: | :----: |
| Graph analysis | PageRank | 有向图上的马尔科夫链 | 平稳分布求解 | 求幂法 |

### 基本定义

PageRank描述了在一个有向图上随机访问各个结点，各个结点在一定条件下被访问概率收敛到的平稳分布。

例如

历史上其作为计算互联网网页重要度的算法被提出，也应用于社会影响力分析，文本摘要等多个场景。

在上述有向图例子中定义随机游走模型，即一阶马尔可夫链，图结点表示状态，有向边表示状态转移，定义状态转移矩阵 $M$ 如下


$$
M=[m_{ij}]_{n\times n}\\
$$


$$
while:\,\ m_{ij}\geq 0\,\ \,\ \sum_{i=1}^n m_{ij} =1
$$



以 $R_t$ 表示 $t$ 时刻访问各个结点的概率分布，那么递推的概率分布满足


$$
R_{t+1}=MR_{t}
$$
极限向量 $R$ 存在，则表示了马尔可夫链的平稳分布


$$
\lim_{t\rightarrow \infty} M^tR_{0} = R\,\ ,\,\ MR=R
$$
其中 $R$ 的各个分量即各个结点的 $PageRank$ 值  


$$
R={\left[ \begin{matrix}PR_{(v_1)}\\PR_{(v_1)}\\.\\.\\.\\PR_{(v_n)} \end{matrix}\right] }
$$


此处引一定理

> 不可约且非周期的有限状态马尔可夫链，有唯一的平稳分布存在，并且当事件趋于无穷时状态分布收敛于唯一的平稳分布

这也证实了这一分析算法在特定条件下的有效性。



### 一般定义

当然，很多现实情况下的图模型并不满足强连通的性质，往往转移矩阵并不能满足每列分量和为0的情况，继而导致最后 $PageRank$ 分量值全部趋于0。

因此引入另一个完全随机游走的模型，表示从任意结点到任意一个结点的转移概率均为 $1/n$ ，与先前的基本定义模型一起组成在给定含有 $n$ 个结点的有向图上的一般随机游走模型，其平稳分布满足  


$$
R=dMR+\frac{1-d}{n}\overrightarrow 1
$$


其中引入线性阻尼因子 $d$ ，由分析经验决定。

此处个人理解为，前半部分是以基本定义中的转移矩阵等概率转移，而后半部分则是完全随机跳转。



### 平稳分布求解

#### 基本定义的计算

~~~python
# 确定转移矩阵M,阻尼因子d,初始向量R[0],计算精度epsilon
t = 0
while R[t+1]-R[t] > epsilon : 		#充分接近，停止迭代
    R[t+1] = d*M*R[t]+((1-d)/n)*1	#迭代计算 R
    t = t+1							#更新t
R = R[t]							#得到最终趋于平稳的 PageRank 值
~~~

#### 求幂法计算一般定义的PageRank

主要用于近似计算矩阵的主特征值和主特征向量，即绝对值最大特征值及对应的特征向量。

来看主要的推导：

假设计算 $n$ 阶矩阵 $M$ 的主特征值与特征向量

构造向量序列，其中 $R_0$ 为一任取的 $n$ 维初始向量    


$$
R_0\,\ ,\,\ R_1=MR_0\,\ ,\,\ ...\,\ ,\,\ R_t= MR_{t-1}
$$


矩阵特征值与对应的线性无关的特征向量表示如下  


$$
|\lambda_1|\geq |\lambda_1|\geq ...\geq |\lambda_n|\\
u_1,u_2,...,u_n
$$


那么 $n$ 维向量可以表示为特征向量的线性组合  


$$
R_t=M^tR_0\\
R_t=a_1\lambda_{1}^tu_1+a_2\lambda_{2}^tu_2+...+a_n\lambda_{n}^tu_n
$$


其中将最大的特征值提出  


$$
R_t=a_1\lambda_{1}^t[u_1+\frac{a_2}{a_1}(\frac{\lambda_2}{\lambda_1})^tu_2+...+\frac{a_n}{a_1}(\frac{\lambda_n}{\lambda_1})^tu_n]
$$

$$
t\rightarrow \infty,\,\ R_t\rightarrow a_1\lambda_{1}^tu_1
$$



此时再由递推公式分量相除可得 


$$
\lambda_1 \approx \frac{R_{t+1}}{R_t}
$$


实际计算时，通常需要在每步迭代时进行规范化，以向量除以范数，即向量的无穷范数，各分量绝对值的最大值 


$$
||R||_{\infty} = max\{|r_1|,|r_2|,...,|r_n|\}
$$


规范化处理过程为  


$$
R_{t+1}=MR_t\\
R_{t+1}=\frac{R_{t+1}}{||R_{t+1}||}
$$

> 根据 Perron-Frobenius  定理，一般PageRank的向量为转移矩阵的主特征向量，主特征值为1
>
> 转移矩阵表示为 
> $$
> M' = dM+\frac{1-d}{n}E
> $$

~~~python
# 确定转移矩阵M,阻尼因子d,初始向量R[0],计算精度epsilon
t = 0
M = d*M + ((1-d)/n)*E
while ||R[t+1]-R[t]|| > epsilon :	#充分接近，停止迭代
    R[t+1] = M*R[t]					#迭代计算 R
    R[t+1] = R[t+1]/||R[t+1]||`		#规范化
    t = t+1							#更新 t 
R = R[t]							#得到趋于收敛的 R
R = R/||R||							#规范最终平稳的 PageRank 值
~~~

